!function(i){var t=function(t,n){var e,o,a,r,d,c,g,l;a=i(t);var s='<div id="lightbox-overlay"><div id="lightbox-close"></div><div id="img-wrapper"><div id="left-control"><div class="arrow left"></div></div><div id="img"></div><div id="right-control"><div class="arrow right"></div></div><div id="helper"><div id="helper-text"></div></div></div><div id="img-loading"><div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div></div></div>',h={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return h.Android()||h.BlackBerry()||h.iOS()||h.Opera()||h.Windows()}};d=[],c=0;var m=i.extend({caption1:"Изображение",caption2:"из",margin:100,marginMobile:10,speed1:200,speed2:200,helper:!0,helperType:"number",animateImage:function(t,n,e){var o=i("#img-wrapper");o.width()==Math.floor(t)&&o.height()==Math.floor(n)?(i("#img-loading").hide(),i("#img > img").css({opacity:1})):o.css({"margin-top":e,width:Math.floor(t),height:Math.floor(n)}).on("webkitTransitionEnd transitionend oTransitionEnd otransitionend MSTransitionEnd",function(){i("#img-loading").hide(),i("#img > img").css({opacity:1})})},clearBox:function(){i("#img > img").css({opacity:0}).parent().empty()}},n||{}),v=function(){g="";var t=i("#img > img").attr("data-margin");b(i("#img > img").get(0),t)},f=function(){var t=i("#img > img").attr("data-context"),n=i("#"+t+' a[data-img="'+i("#img > img").attr("src")+'"]').prev();n.children("img").data("direction","prev"),n.children("img").click(),i(document).trigger("infinity-prev")},u=function(){var t=i("#img > img").attr("data-context"),n=i("#"+t+' a[data-img="'+i("#img > img").attr("src")+'"]').next();n.children("img").data("direction","next"),n.children("img").click(),i(document).trigger("infinity-next")},p=function(){a.find("a > img").data("direction",""),i("#lightbox-overlay").hide(),i("body").css({"overflow-y":"scroll"}),i(document).trigger("infinity-close")},y=function(i){return{"-webkit-transition":"all "+i+"ms ease 0s","-moz-transition":"all "+i+"ms ease 0s","-o-transition":"all "+i+"ms ease 0s",transition:"all "+i+"ms ease 0s"}},w=function(i){37===i.keyCode?f():39===i.keyCode&&u()},b=function(t,n){var r,d,c,l,s=y(m.speed2);r=t.width/t.height,o=i(window).width()-2*n-8,e=i(window).height()-2*n-8,o>e?(l=e,c=l*r):(c=o,l=c/r),d=-1*l/2-4,i(t).css({opacity:0}).attr("data-aspect",r).attr("data-margin",n).attr("data-context",a.context.id).css(s),i("#img").empty().append(t),m.animateImage(c,l,d,g)};if(a.data("settings",m),0==i("#lightbox-overlay").length&&i("body").append(s),null==a.attr("id")){var x=Math.floor(99*Math.random());a.attr("id","infinityLightbox"+x)}a.find("a[data-img]").click(function(t){var n,l=a.data("settings");if(i("#img-wrapper, #img").css(y(l.speed1)),g=i(t.target).data("direction")||"",i(document).trigger("infinity-open"),e=i(window).height(),o=i(window).width(),t.preventDefault(),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,i("body").css({overflow:"hidden"}),h.any()&&(i("#left-control, #right-control").addClass("mobile"),i("#lightbox-overlay").css({"background-color":"#000"}),i("#lightbox-close").show()),i("#right-control, #left-control").css({opacity:"1"}).show(),l.clearBox(g),i("#lightbox-overlay").show(),i("#img-loading").show(),i("#helper").show(),n=a.find("a[data-img]"),c=n.index(i(t.target).parent("a")),-1===c&&(c=n.index(i(t.target))),length=n.length,c==length-1&&i("#right-control").css({opacity:"0"}).hide(),0==c&&i("#left-control").css({opacity:"0"}).hide(),l.helper===!0){if("number"==l.helperType)i("#helper-text").text(l.caption1+" "+(c+1)+" "+l.caption2+" "+length);else if("alt"==l.helperType){var s=i(t.target).attr("alt")||"";""!==s?i("#helper-text").text(s):i("#helper").hide()}}else i("#helper").hide();margin=h.any()?l.marginMobile:l.margin,null!=d[c]?b(d[c],margin):(r=new Image,r.src=i(n.get(c)).attr("data-img"),i(r).load(function(){d[c]=r,b(r,margin)})),i(window).off("resize",v),i(window).on("resize",v),i(document).off("keydown",w),i(document).on("keydown",w)}),i("#right-control").unbind("click"),i("#right-control").click(u),i("#left-control").unbind("click"),i("#left-control").click(f),i("#img").off("touchmove"),i("#img").off("touchstart"),i("#img").on("touchstart",function(i){var t=i.originalEvent.touches[0]||i.originalEvent.changedTouches[0];l=t.clientX}),i("#img").on("touchmove",function(t){var n,e=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0],o=e.clientX;if(n=Math.abs(o-l),n>.05*i(window).width()){var a=o>l?"right":"left";"right"==a?f():u()}}),i("#lightbox-overlay").click(function(t){"lightbox-overlay"===i(t.target).attr("id")&&p()}),i("#lightbox-close").click(p)};i.fn.infinityLightbox=function(n){return this.each(function(){var e=i(this);if(!e.data("infinityLightbox")){var o=new t(this,n);e.data("infinityLightbox",o)}})}}(jQuery);