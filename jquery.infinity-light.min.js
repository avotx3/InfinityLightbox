(function(e){var t=function(t,n){var r,i,s,o,u,a,f,l,c,h,p;a=e(t);var d='<div id="lightbox-overlay">'+'<div id="lightbox-close"></div>'+'<div id="img-wrapper">'+'<div id="left-control">'+'<div class="arrow left"></div></div>'+'<div id="img"></div>'+'<div id="right-control">'+'<div class="arrow right"></div></div>'+'<div id="helper">'+'<div id="helper-text"></div>'+"</div></div>"+'<div id="img-loading"><div class="spinner">'+'<div class="bounce1"></div>'+'<div class="bounce2"></div>'+'<div class="bounce3"></div>'+"</div></div></div>";var v={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return v.Android()||v.BlackBerry()||v.iOS()||v.Opera()||v.Windows()}};l=[];c=0;var m=e.extend({caption1:"Изображение",caption2:"из",margin:100,marginMobile:10,speed1:200,speed2:200,helper:true,helperType:"number",animateImage:function(t,n,r,i){var s=e("#img-wrapper");if(s.width()==Math.floor(t)&&s.height()==Math.floor(n)){e("#img-loading").hide();e("#img > img").css({opacity:1})}else{s.css({"margin-top":r,width:Math.floor(t),height:Math.floor(n)}).on("webkitTransitionEnd transitionend oTransitionEnd otransitionend MSTransitionEnd",function(){e("#img-loading").hide();e("#img > img").css({opacity:1})})}},clearBox:function(t){e("#img > img").css({opacity:0})}},n||{});var g=function(){h="";var t=e("#img > img").attr("data-margin");S(e("#img > img").get(0),t)};var y=function(){var t=e("#img > img").attr("data-context");var n=e("#"+t+' a[data-img="'+e("#img > img").attr("src")+'"]').prev();n.children("img").data("direction","prev");n.children("img").click();e(document).trigger("infinity-prev")};var b=function(){var t=e("#img > img").attr("data-context");var n=e("#"+t+' a[data-img="'+e("#img > img").attr("src")+'"]').next();n.children("img").data("direction","next");n.children("img").click();e(document).trigger("infinity-next")};var w=function(){a.find("a > img").data("direction","");e("#lightbox-overlay").hide();e("body").css({"overflow-y":"scroll"});e(document).trigger("infinity-close")};var E=function(e){return{"-webkit-transition":"all "+e+"ms ease 0s","-moz-transition":"all "+e+"ms ease 0s","-o-transition":"all "+e+"ms ease 0s",transition:"all "+e+"ms ease 0s"}};var S=function(t,n){var s,o,u,f,l=E(m.speed2);s=t.width/t.height;i=e(window).width()-n*2-8;r=e(window).height()-n*2-8;if(i>r){f=r;u=f*s}else{u=i;f=u/s}o=-1*f/2-4;e(t).css({opacity:0}).attr("data-aspect",s).attr("data-margin",n).attr("data-context",a.context.id).css(l);e("#img").empty().append(t);m.animateImage(u,f,o,h)};a.data("settings",m);if(e("#lightbox-overlay").length==0){e("body").append(d)}if(a.attr("id")==null){var x=Math.floor(Math.random()*99);a.attr("id","infinityLightbox"+x)}a.find("a[data-img]").click(function(t){var n=a.data("settings"),s;e("#img-wrapper, #img").css(E(n.speed1));h=e(t.target).data("direction")||"";e(document).trigger("infinity-open");r=e(window).height();i=e(window).width();t.preventDefault();t.stopPropagation?t.stopPropagation():t.cancelBubble=true;e("body").css({overflow:"hidden"});if(v.any()){e("#left-control, #right-control").addClass("mobile");e("#lightbox-overlay").css({"background-color":"#000"});e("#lightbox-close").show()}e("#right-control, #left-control").css({opacity:"1"}).show();n.clearBox(h);e("#lightbox-overlay").show();e("#img-loading").show();e("#helper").show();s=a.find("a[data-img]");c=s.index(e(t.target).parent("a"));if(c===-1){c=s.index(e(t.target))}length=s.length;if(c==length-1){e("#right-control").css({opacity:"0"}).hide()}if(c==0){e("#left-control").css({opacity:"0"}).hide()}if(n.helper===true){if(n.helperType=="number"){e("#helper-text").text(n.caption1+" "+(c+1)+" "+n.caption2+" "+length)}else if(n.helperType=="alt"){var o=e(t.target).attr("alt")||"";if(o!==""){e("#helper-text").text(o)}else{e("#helper").hide()}}}else{e("#helper").hide()}if(v.any()){margin=n.marginMobile}else{margin=n.margin}if(l[c]!=null){S(l[c],margin)}else{f=new Image;f.src=e(s.get(c)).attr("data-img");e(f).load(function(){l[c]=f;S(f,margin)})}e(window).off("resize",g);e(window).on("resize",g)});e("#right-control").unbind("click");e("#right-control").click(b);e("#left-control").unbind("click");e("#left-control").click(y);e("#img").off("touchmove");e("#img").off("touchstart");e("#img").on("touchstart",function(e){var t=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];p=t.clientX});e("#img").on("touchmove",function(e){var t=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];var n=t.clientX,r;r=n>p?"right":"left";if(r=="right"){y()}else{b()}});e("#lightbox-overlay").click(function(t){if(e(t.target).attr("id")==="lightbox-overlay"){w()}});e("#lightbox-close").click(w)};e.fn.infinityLightbox=function(n){return this.each(function(){var r=e(this);if(r.data("infinityLightbox"))return;var i=new t(this,n);r.data("infinityLightbox",i)})}})(jQuery)